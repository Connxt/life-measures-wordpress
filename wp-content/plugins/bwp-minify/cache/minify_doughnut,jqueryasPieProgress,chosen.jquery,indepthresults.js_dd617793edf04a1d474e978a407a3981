;
/*!
 * jquery.drawDoughnutChart.js
 * Version: 0.4.1(Beta)
 * Inspired by Chart.js(http://www.chartjs.org/)
 *
 * Copyright 2014 hiro
 * https://github.com/githiro/drawDoughnutChart
 * Released under the MIT license.
 * 
 */
(function($,undefined){$.fn.drawDoughnutChart=function(data,options){var $this=this,W=$this.width(),H=$this.height(),centerX=W/2,centerY=H/2,cos=Math.cos,sin=Math.sin,PI=Math.PI,settings=$.extend({segmentShowStroke:true,segmentStrokeColor:"#fff",segmentStrokeWidth:5,baseColor:"#fff",baseOffset:4,edgeOffset:10,percentageInnerCutout:75,animation:true,animationSteps:90,animationEasing:"easeInOutExpo",animateRotate:true,tipOffsetX:-8,tipOffsetY:-45,tipClass:"doughnutTip",summaryClass:"doughnutSummary",summaryTitle:"",summaryTitleClass:"doughnutSummaryTitle",summaryNumberClass:"doughnutSummaryNumber",beforeDraw:function(){},afterDrawed:function(){},onPathEnter:function(e,data){},onPathLeave:function(e,data){}},options),animationOptions={linear:function(t){return t;},easeInOutExpo:function(t){var v=t<.5?8*t*t*t*t:1-8*(--t)*t*t*t;return(v>1)?1:v;}},requestAnimFrame=function(){return window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(callback){window.setTimeout(callback,1000/60);};}();settings.beforeDraw.call($this);var $svg=$('<svg width="'+W+'" height="'+H+'" viewBox="0 0 '+W+' '+H+'" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"></svg>').appendTo($this),$paths=[],easingFunction=animationOptions[settings.animationEasing],doughnutRadius=Min([H/2,W/2])-settings.edgeOffset,cutoutRadius=doughnutRadius*(settings.percentageInnerCutout/130),segmentTotal=0;var baseDoughnutRadius=doughnutRadius+settings.baseOffset,baseCutoutRadius=cutoutRadius-settings.baseOffset;$(document.createElementNS('http://www.w3.org/2000/svg','path')).attr({"d":getHollowCirclePath(baseDoughnutRadius,baseCutoutRadius),"fill":settings.baseColor}).appendTo($svg);var $pathGroup=$(document.createElementNS('http://www.w3.org/2000/svg','g'));$pathGroup.attr({opacity:0}).appendTo($svg);var $tip=$('<div class="'+settings.tipClass+'" />').appendTo('body').hide(),tipW=$tip.width(),tipH=$tip.height();var summarySize=(cutoutRadius-(doughnutRadius-cutoutRadius))*2,$summary=$('<div class="'+settings.summaryClass+'" />').appendTo($this).css({width:summarySize+"px",height:summarySize+"px","margin-left":-(summarySize/2)+"px","margin-top":-(summarySize/2)+"px"});var $summaryTitle=$('<p class="'+settings.summaryTitleClass+'">'+settings.summaryTitle+'</p>').appendTo($summary);var $summaryNumber=$('<p class="'+settings.summaryNumberClass+'"></p>').appendTo($summary).css({opacity:0});for(var i=0,len=data.length;i<len;i++){segmentTotal+=data[i].value;$paths[i]=$(document.createElementNS('http://www.w3.org/2000/svg','path')).attr({"stroke-width":settings.segmentStrokeWidth,"stroke":settings.segmentStrokeColor,"fill":data[i].color,"data-order":i}).appendTo($pathGroup).on("mouseenter",pathMouseEnter).on("mouseleave",pathMouseLeave).on("mousemove",pathMouseMove);}
animationLoop(drawPieSegments);function getHollowCirclePath(doughnutRadius,cutoutRadius){var startRadius=-1.570,segmentAngle=6.2831,endRadius=4.7131,startX=centerX+cos(startRadius)*doughnutRadius,startY=centerY+sin(startRadius)*doughnutRadius,endX2=centerX+cos(startRadius)*cutoutRadius,endY2=centerY+sin(startRadius)*cutoutRadius,endX=centerX+cos(endRadius)*doughnutRadius,endY=centerY+sin(endRadius)*doughnutRadius,startX2=centerX+cos(endRadius)*cutoutRadius,startY2=centerY+sin(endRadius)*cutoutRadius;var cmd=['M',startX,startY,'A',doughnutRadius,doughnutRadius,0,1,1,endX,endY,'Z','M',startX2,startY2,'A',cutoutRadius,cutoutRadius,0,1,0,endX2,endY2,'Z'];cmd=cmd.join(' ');return cmd;};function pathMouseEnter(e){var order=$(this).data().order;$tip.text(data[order].title+": "+data[order].value).fadeIn(200);settings.onPathEnter.apply($(this),[e,data]);}
function pathMouseLeave(e){$tip.hide();settings.onPathLeave.apply($(this),[e,data]);}
function pathMouseMove(e){$tip.css({top:e.pageY+settings.tipOffsetY,left:e.pageX-$tip.width()/2+settings.tipOffsetX});}
function drawPieSegments(animationDecimal){var startRadius=-PI/2,rotateAnimation=1;if(settings.animation&&settings.animateRotate)rotateAnimation=animationDecimal;drawDoughnutText(animationDecimal,segmentTotal);$pathGroup.attr("opacity",animationDecimal);if(data.length===1&&(4.7122<(rotateAnimation*((data[0].value/segmentTotal)*(PI*2))+startRadius))){$paths[0].attr("d",getHollowCirclePath(doughnutRadius,cutoutRadius));return;}
for(var i=0,len=data.length;i<len;i++){var segmentAngle=rotateAnimation*((data[i].value/segmentTotal)*(PI*2)),endRadius=startRadius+segmentAngle,largeArc=((endRadius-startRadius)%(PI*2))>PI?1:0,startX=centerX+cos(startRadius)*doughnutRadius,startY=centerY+sin(startRadius)*doughnutRadius,endX2=centerX+cos(startRadius)*cutoutRadius,endY2=centerY+sin(startRadius)*cutoutRadius,endX=centerX+cos(endRadius)*doughnutRadius,endY=centerY+sin(endRadius)*doughnutRadius,startX2=centerX+cos(endRadius)*cutoutRadius,startY2=centerY+sin(endRadius)*cutoutRadius;var cmd=['M',startX,startY,'A',doughnutRadius,doughnutRadius,0,largeArc,1,endX,endY,'L',startX2,startY2,'A',cutoutRadius,cutoutRadius,0,largeArc,0,endX2,endY2,'Z'];$paths[i].attr("d",cmd.join(' '));startRadius+=segmentAngle;}}
function drawDoughnutText(animationDecimal,segmentTotal){$summaryNumber.css({opacity:animationDecimal}).text((segmentTotal*animationDecimal).toFixed(1));}
function animateFrame(cnt,drawData){var easeAdjustedAnimationPercent=(settings.animation)?CapValue(easingFunction(cnt),null,0):1;drawData(easeAdjustedAnimationPercent);}
function animationLoop(drawData){var animFrameAmount=(settings.animation)?1/CapValue(settings.animationSteps,Number.MAX_VALUE,1):1,cnt=(settings.animation)?0:1;requestAnimFrame(function(){cnt+=animFrameAmount;animateFrame(cnt,drawData);if(cnt<=1){requestAnimFrame(arguments.callee);}else{settings.afterDrawed.call($this);}});}
function Max(arr){return Math.max.apply(null,arr);}
function Min(arr){return Math.min.apply(null,arr);}
function isNumber(n){return!isNaN(parseFloat(n))&&isFinite(n);}
function CapValue(valueToCap,maxValue,minValue){if(isNumber(maxValue)&&valueToCap>maxValue)return maxValue;if(isNumber(minValue)&&valueToCap<minValue)return minValue;return valueToCap;}
return $this;};})(jQuery);;(function(factory){"use strict";if(typeof define==='function'&&define.amd){define(['jquery'],factory);}else{factory(jQuery);}}(function($){"use strict";if(!Date.now){Date.now=function(){return new Date().getTime();};}
function getTime(){if(typeof window.performance!=='undefined'&&window.performance.now){return window.performance.now();}else{return Date.now();}}
var vendors=['webkit','moz'];for(var i=0;i<vendors.length&&!window.requestAnimationFrame;++i){var vp=vendors[i];window.requestAnimationFrame=window[vp+'RequestAnimationFrame'];window.cancelAnimationFrame=(window[vp+'CancelAnimationFrame']||window[vp+'CancelRequestAnimationFrame']);}
if(/iP(ad|hone|od).*OS (6|7)/.test(window.navigator.userAgent)||!window.requestAnimationFrame||!window.cancelAnimationFrame){var lastTime=0;window.requestAnimationFrame=function(callback){var now=getTime();var nextTime=Math.max(lastTime+16,now);return setTimeout(function(){callback(lastTime=nextTime);},nextTime-now);};window.cancelAnimationFrame=clearTimeout;}
var SvgElement=function(tag,attrs){var elem=document.createElementNS("http://www.w3.org/2000/svg",tag);$.each(attrs,function(name,value){elem.setAttribute(name,value);});return elem;}
var svgSupported="createElementNS"in document&&new SvgElement("svg",{}).createSVGRect;function isPercentage(n){return typeof n==='string'&&n.indexOf('%')!=-1;}
var pluginName='asPieProgress';var Plugin=$[pluginName]=function(element,options){this.element=element;this.$element=$(element);this.options=$.extend({},Plugin.defaults,options,this.$element.data());this.namespace=this.options.namespace;this.classes=this.options.classes;this.easing=Plugin.easing[this.options.easing]||Plugin.easing.ease;this.$element.addClass(this.classes.element);this.min=this.$element.attr('aria-valuemin');this.max=this.$element.attr('aria-valuemax');this.min=this.min?parseInt(this.min,10):this.options.min;this.max=this.max?parseInt(this.max,10):this.options.max;this.first=this.$element.attr('aria-valuenow');this.first=this.first?parseInt(this.first,10):(this.options.first?this.options.first:this.min);this.now=this.first;this.goal=this.options.goal;this._frameId=null;this.initialized=false;this._trigger('init');this.init();};Plugin.defaults={namespace:'asPieProgress',classes:{element:'pie_progress',number:'pie_progress__number',content:'pie_progress__content'},min:0,max:100,goal:100,size:160,speed:15,barcolor:'#ef1e25',barsize:'4',trackcolor:'#fff',fillcolor:'none',easing:'ease',numberCallback:function(n){var percentage=Math.round(this.getPercentage(n));return percentage+'%';},contentCallback:null};var easingBezier=function(mX1,mY1,mX2,mY2){function A(aA1,aA2){return 1.0-3.0*aA2+3.0*aA1;}
function B(aA1,aA2){return 3.0*aA2-6.0*aA1;}
function C(aA1){return 3.0*aA1;}
function CalcBezier(aT,aA1,aA2){return((A(aA1,aA2)*aT+B(aA1,aA2))*aT+C(aA1))*aT;}
function GetSlope(aT,aA1,aA2){return 3.0*A(aA1,aA2)*aT*aT+2.0*B(aA1,aA2)*aT+C(aA1);}
function GetTForX(aX){var aGuessT=aX;for(var i=0;i<4;++i){var currentSlope=GetSlope(aGuessT,mX1,mX2);if(currentSlope===0.0)return aGuessT;var currentX=CalcBezier(aGuessT,mX1,mX2)-aX;aGuessT-=currentX/currentSlope;}
return aGuessT;}
if(mX1===mY1&&mX2===mY2){return{css:'linear',fn:function(aX){return aX;}};}else{return{css:'cubic-bezier('+mX1+','+mY1+','+mX2+','+mY2+')',fn:function(aX){return CalcBezier(GetTForX(aX),mY1,mY2);}}}};$.extend(Plugin.easing={},{"ease":easingBezier(0.25,0.1,0.25,1.0),"linear":easingBezier(0.00,0.0,1.00,1.0),"ease-in":easingBezier(0.42,0.0,1.00,1.0),"ease-out":easingBezier(0.00,0.0,0.58,1.0),"ease-in-out":easingBezier(0.42,0.0,0.58,1.0)});Plugin.prototype={constructor:Plugin,init:function(){this.$number=this.$element.find('.'+this.classes.number);this.$content=this.$element.find('.'+this.classes.content);this.size=this.options.size;this.width=this.size;this.height=this.size;this.prepare();this.initialized=true;this._trigger('ready');},prepare:function(){if(!svgSupported){return;}
this.svg=new SvgElement("svg",{"width":"100%","height":"100%","viewBox":"0 0 "+this.width+" "+this.height});this.buildTrack();this.buildBar();this.$element.append(this.svg);},buildTrack:function(){var width=this.size,height=this.size,cx=width/2,cy=height/2;var barsize=this.options.barsize;var ellipse=new SvgElement("ellipse",{rx:cx-barsize/2,ry:cy-barsize/2,cx:cx,cy:cy,stroke:this.options.trackcolor,fill:this.options.fillcolor,'stroke-width':barsize});this.svg.appendChild(ellipse);},buildBar:function(){if(!svgSupported){return;}
var path=new SvgElement("path",{fill:'none','stroke-width':this.options.barsize,stroke:this.options.barcolor});this.bar=path;this.svg.appendChild(path);this._drawBar(this.first);this._updateBar();},_drawBar:function(n){if(!svgSupported){return;}
this.bar_goal=n;var width=this.size,height=this.size,cx=width/2,cy=height/2,start_angle=0;var barsize=this.options.barsize;var r=Math.min(cx,cy)-barsize/2;this.r=r;var percentage=this.getPercentage(n);if(percentage===100){percentage-=0.0001;}
var end_angle=start_angle+percentage*Math.PI*2/100;var x1=cx+r*Math.sin(start_angle),y1=cy-r*Math.cos(start_angle),x2=cx+r*Math.sin(end_angle),y2=cy-r*Math.cos(end_angle);var big=0;if(end_angle-start_angle>Math.PI)big=1;var d="M"+x1+","+y1+" A"+r+","+r+" 0 "+big+" 1 "+
x2+","+y2;this.bar.setAttribute("d",d);},_updateBar:function(){if(!svgSupported){return;}
var percenage=this.getPercentage(this.now);var length=this.bar.getTotalLength();var offset=length*(1-percenage/this.getPercentage(this.bar_goal));this.bar.style.strokeDasharray=length+" "+length;this.bar.style.strokeDashoffset=offset;},_trigger:function(eventType){var method_arguments=Array.prototype.slice.call(arguments,1),data=[this].concat(method_arguments);this.$element.trigger(pluginName+'::'+eventType,data);eventType=eventType.replace(/\b\w+\b/g,function(word){return word.substring(0,1).toUpperCase()+word.substring(1);});var onFunction='on'+eventType;if(typeof this.options[onFunction]==='function'){this.options[onFunction].apply(this,method_arguments);}},getPercentage:function(n){return 100*(n-this.min)/(this.max-this.min);},go:function(goal){var self=this;this._clear();if(isPercentage(goal)){goal=parseInt(goal.replace('%',''),10);goal=Math.round(this.min+(goal/100)*(this.max-this.min));}
if(typeof goal==='undefined'){goal=this.goal;}
if(goal>this.max){goal=this.max;}else if(goal<this.min){goal=this.min;}
if(this.bar_goal<goal){this._drawBar(goal);}
var start=self.now;var startTime=getTime();var endTime=startTime+Math.abs(start-goal)*100*self.options.speed/(self.max-self.min);var animation=function(time){var next;if(time>endTime){next=goal;}else{var distance=(time-startTime)/self.options.speed;next=Math.round(self.easing.fn(distance/100)*(self.max-self.min));if(goal>start){next=start+next;if(next>goal){next=goal;}}else{next=start-next;if(next<goal){next=goal;}}}
self._update(next);if(next===goal){window.cancelAnimationFrame(self._frameId);self._frameId=null;if(self.now===self.goal){self._trigger('finish');}}else{self._frameId=window.requestAnimationFrame(animation);}};self._frameId=window.requestAnimationFrame(animation);},_update:function(n){this.now=n;this._updateBar();this.$element.attr('aria-valuenow',this.now);if(this.$number.length>0&&typeof this.options.numberCallback==='function'){this.$number.html(this.options.numberCallback.call(this,[this.now]));}
if(this.$content.length>0&&typeof this.options.contentCallback==='function'){this.$content.html(this.options.contentCallback.call(this,[this.now]));}
this._trigger('update',n);},_clear:function(){if(this._frameId){window.cancelAnimationFrame(this._frameId);this._frameId=null;}},get:function(){return this.now;},start:function(){this._clear();this._trigger('start');this.go(this.goal);},reset:function(){this._clear();this._drawBar(this.first);this._update(this.first);this._trigger('reset');},stop:function(){this._clear();this._trigger('stop');},finish:function(){this._clear();this._update(this.goal);this._trigger('finish');},destory:function(){this.$element.data(pluginName,null);this._trigger('destory');}};$.fn[pluginName]=function(options){if(typeof options==='string'){var method=options;var method_arguments=Array.prototype.slice.call(arguments,1);if(/^\_/.test(method)){return false;}else if((/^(get)$/.test(method))){var api=this.first().data(pluginName);if(api&&typeof api[method]==='function'){return api[method].apply(api,method_arguments);}}else{return this.each(function(){var api=$.data(this,pluginName);if(api&&typeof api[method]==='function'){api[method].apply(api,method_arguments);}});}}else{return this.each(function(){if(!$.data(this,pluginName)){$.data(this,pluginName,new Plugin(this,options));}});}};}));;
/*!
Chosen, a Select Box Enhancer for jQuery and Prototype
by Patrick Filler for Harvest, http://getharvest.com

Version 1.5.1
Full source at https://github.com/harvesthq/chosen
Copyright (c) 2011-2016 Harvest http://getharvest.com

MIT License, https://github.com/harvesthq/chosen/blob/master/LICENSE.md
This file is generated by `grunt build`, do not edit it by hand.
*/
(function(){var $,AbstractChosen,Chosen,SelectParser,_ref,__hasProp={}.hasOwnProperty,__extends=function(child,parent){for(var key in parent){if(__hasProp.call(parent,key))child[key]=parent[key];}function ctor(){this.constructor=child;}ctor.prototype=parent.prototype;child.prototype=new ctor();child.__super__=parent.prototype;return child;};SelectParser=(function(){function SelectParser(){this.options_index=0;this.parsed=[];}
SelectParser.prototype.add_node=function(child){if(child.nodeName.toUpperCase()==="OPTGROUP"){return this.add_group(child);}else{return this.add_option(child);}};SelectParser.prototype.add_group=function(group){var group_position,option,_i,_len,_ref,_results;group_position=this.parsed.length;this.parsed.push({array_index:group_position,group:true,label:this.escapeExpression(group.label),title:group.title?group.title:void 0,children:0,disabled:group.disabled,classes:group.className});_ref=group.childNodes;_results=[];for(_i=0,_len=_ref.length;_i<_len;_i++){option=_ref[_i];_results.push(this.add_option(option,group_position,group.disabled));}
return _results;};SelectParser.prototype.add_option=function(option,group_position,group_disabled){if(option.nodeName.toUpperCase()==="OPTION"){if(option.text!==""){if(group_position!=null){this.parsed[group_position].children+=1;}
this.parsed.push({array_index:this.parsed.length,options_index:this.options_index,value:option.value,text:option.text,html:option.innerHTML,title:option.title?option.title:void 0,selected:option.selected,disabled:group_disabled===true?group_disabled:option.disabled,group_array_index:group_position,group_label:group_position!=null?this.parsed[group_position].label:null,classes:option.className,style:option.style.cssText});}else{this.parsed.push({array_index:this.parsed.length,options_index:this.options_index,empty:true});}
return this.options_index+=1;}};SelectParser.prototype.escapeExpression=function(text){var map,unsafe_chars;if((text==null)||text===false){return"";}
if(!/[\&\<\>\"\'\`]/.test(text)){return text;}
map={"<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#x27;","`":"&#x60;"};unsafe_chars=/&(?!\w+;)|[\<\>\"\'\`]/g;return text.replace(unsafe_chars,function(chr){return map[chr]||"&amp;";});};return SelectParser;})();SelectParser.select_to_array=function(select){var child,parser,_i,_len,_ref;parser=new SelectParser();_ref=select.childNodes;for(_i=0,_len=_ref.length;_i<_len;_i++){child=_ref[_i];parser.add_node(child);}
return parser.parsed;};AbstractChosen=(function(){function AbstractChosen(form_field,options){this.form_field=form_field;this.options=options!=null?options:{};if(!AbstractChosen.browser_is_supported()){return;}
this.is_multiple=this.form_field.multiple;this.set_default_text();this.set_default_values();this.setup();this.set_up_html();this.register_observers();this.on_ready();}
AbstractChosen.prototype.set_default_values=function(){var _this=this;this.click_test_action=function(evt){return _this.test_active_click(evt);};this.activate_action=function(evt){return _this.activate_field(evt);};this.active_field=false;this.mouse_on_container=false;this.results_showing=false;this.result_highlighted=null;this.allow_single_deselect=(this.options.allow_single_deselect!=null)&&(this.form_field.options[0]!=null)&&this.form_field.options[0].text===""?this.options.allow_single_deselect:false;this.disable_search_threshold=this.options.disable_search_threshold||0;this.disable_search=this.options.disable_search||false;this.enable_split_word_search=this.options.enable_split_word_search!=null?this.options.enable_split_word_search:true;this.group_search=this.options.group_search!=null?this.options.group_search:true;this.search_contains=this.options.search_contains||false;this.single_backstroke_delete=this.options.single_backstroke_delete!=null?this.options.single_backstroke_delete:true;this.max_selected_options=this.options.max_selected_options||Infinity;this.inherit_select_classes=this.options.inherit_select_classes||false;this.display_selected_options=this.options.display_selected_options!=null?this.options.display_selected_options:true;this.display_disabled_options=this.options.display_disabled_options!=null?this.options.display_disabled_options:true;this.include_group_label_in_selected=this.options.include_group_label_in_selected||false;return this.max_shown_results=this.options.max_shown_results||Number.POSITIVE_INFINITY;};AbstractChosen.prototype.set_default_text=function(){if(this.form_field.getAttribute("data-placeholder")){this.default_text=this.form_field.getAttribute("data-placeholder");}else if(this.is_multiple){this.default_text=this.options.placeholder_text_multiple||this.options.placeholder_text||AbstractChosen.default_multiple_text;}else{this.default_text=this.options.placeholder_text_single||this.options.placeholder_text||AbstractChosen.default_single_text;}
return this.results_none_found=this.form_field.getAttribute("data-no_results_text")||this.options.no_results_text||AbstractChosen.default_no_result_text;};AbstractChosen.prototype.choice_label=function(item){if(this.include_group_label_in_selected&&(item.group_label!=null)){return"<b class='group-name'>"+item.group_label+"</b>"+item.html;}else{return item.html;}};AbstractChosen.prototype.mouse_enter=function(){return this.mouse_on_container=true;};AbstractChosen.prototype.mouse_leave=function(){return this.mouse_on_container=false;};AbstractChosen.prototype.input_focus=function(evt){var _this=this;if(this.is_multiple){if(!this.active_field){return setTimeout((function(){return _this.container_mousedown();}),50);}}else{if(!this.active_field){return this.activate_field();}}};AbstractChosen.prototype.input_blur=function(evt){var _this=this;if(!this.mouse_on_container){this.active_field=false;return setTimeout((function(){return _this.blur_test();}),100);}};AbstractChosen.prototype.results_option_build=function(options){var content,data,data_content,shown_results,_i,_len,_ref;content='';shown_results=0;_ref=this.results_data;for(_i=0,_len=_ref.length;_i<_len;_i++){data=_ref[_i];data_content='';if(data.group){data_content=this.result_add_group(data);}else{data_content=this.result_add_option(data);}
if(data_content!==''){shown_results++;content+=data_content;}
if(options!=null?options.first:void 0){if(data.selected&&this.is_multiple){this.choice_build(data);}else if(data.selected&&!this.is_multiple){this.single_set_selected_text(this.choice_label(data));}}
if(shown_results>=this.max_shown_results){break;}}
return content;};AbstractChosen.prototype.result_add_option=function(option){var classes,option_el;if(!option.search_match){return'';}
if(!this.include_option_in_results(option)){return'';}
classes=[];if(!option.disabled&&!(option.selected&&this.is_multiple)){classes.push("active-result");}
if(option.disabled&&!(option.selected&&this.is_multiple)){classes.push("disabled-result");}
if(option.selected){classes.push("result-selected");}
if(option.group_array_index!=null){classes.push("group-option");}
if(option.classes!==""){classes.push(option.classes);}
option_el=document.createElement("li");option_el.className=classes.join(" ");option_el.style.cssText=option.style;option_el.setAttribute("data-option-array-index",option.array_index);option_el.innerHTML=option.search_text;if(option.title){option_el.title=option.title;}
return this.outerHTML(option_el);};AbstractChosen.prototype.result_add_group=function(group){var classes,group_el;if(!(group.search_match||group.group_match)){return'';}
if(!(group.active_options>0)){return'';}
classes=[];classes.push("group-result");if(group.classes){classes.push(group.classes);}
group_el=document.createElement("li");group_el.className=classes.join(" ");group_el.innerHTML=group.search_text;if(group.title){group_el.title=group.title;}
return this.outerHTML(group_el);};AbstractChosen.prototype.results_update_field=function(){this.set_default_text();if(!this.is_multiple){this.results_reset_cleanup();}
this.result_clear_highlight();this.results_build();if(this.results_showing){return this.winnow_results();}};AbstractChosen.prototype.reset_single_select_options=function(){var result,_i,_len,_ref,_results;_ref=this.results_data;_results=[];for(_i=0,_len=_ref.length;_i<_len;_i++){result=_ref[_i];if(result.selected){_results.push(result.selected=false);}else{_results.push(void 0);}}
return _results;};AbstractChosen.prototype.results_toggle=function(){if(this.results_showing){return this.results_hide();}else{return this.results_show();}};AbstractChosen.prototype.results_search=function(evt){if(this.results_showing){return this.winnow_results();}else{return this.results_show();}};AbstractChosen.prototype.winnow_results=function(){var escapedSearchText,option,regex,results,results_group,searchText,startpos,text,zregex,_i,_len,_ref;this.no_results_clear();results=0;searchText=this.get_search_text();escapedSearchText=searchText.replace(/[-[\]{}()*+?.,\\^$|#\s]/g,"\\$&");zregex=new RegExp(escapedSearchText,'i');regex=this.get_search_regex(escapedSearchText);_ref=this.results_data;for(_i=0,_len=_ref.length;_i<_len;_i++){option=_ref[_i];option.search_match=false;results_group=null;if(this.include_option_in_results(option)){if(option.group){option.group_match=false;option.active_options=0;}
if((option.group_array_index!=null)&&this.results_data[option.group_array_index]){results_group=this.results_data[option.group_array_index];if(results_group.active_options===0&&results_group.search_match){results+=1;}
results_group.active_options+=1;}
option.search_text=option.group?option.label:option.html;if(!(option.group&&!this.group_search)){option.search_match=this.search_string_match(option.search_text,regex);if(option.search_match&&!option.group){results+=1;}
if(option.search_match){if(searchText.length){startpos=option.search_text.search(zregex);text=option.search_text.substr(0,startpos+searchText.length)+'</em>'+option.search_text.substr(startpos+searchText.length);option.search_text=text.substr(0,startpos)+'<em>'+text.substr(startpos);}
if(results_group!=null){results_group.group_match=true;}}else if((option.group_array_index!=null)&&this.results_data[option.group_array_index].search_match){option.search_match=true;}}}}
this.result_clear_highlight();if(results<1&&searchText.length){this.update_results_content("");return this.no_results(searchText);}else{this.update_results_content(this.results_option_build());return this.winnow_results_set_highlight();}};AbstractChosen.prototype.get_search_regex=function(escaped_search_string){var regex_anchor;regex_anchor=this.search_contains?"":"^";return new RegExp(regex_anchor+escaped_search_string,'i');};AbstractChosen.prototype.search_string_match=function(search_string,regex){var part,parts,_i,_len;if(regex.test(search_string)){return true;}else if(this.enable_split_word_search&&(search_string.indexOf(" ")>=0||search_string.indexOf("[")===0)){parts=search_string.replace(/\[|\]/g,"").split(" ");if(parts.length){for(_i=0,_len=parts.length;_i<_len;_i++){part=parts[_i];if(regex.test(part)){return true;}}}}};AbstractChosen.prototype.choices_count=function(){var option,_i,_len,_ref;if(this.selected_option_count!=null){return this.selected_option_count;}
this.selected_option_count=0;_ref=this.form_field.options;for(_i=0,_len=_ref.length;_i<_len;_i++){option=_ref[_i];if(option.selected){this.selected_option_count+=1;}}
return this.selected_option_count;};AbstractChosen.prototype.choices_click=function(evt){evt.preventDefault();if(!(this.results_showing||this.is_disabled)){return this.results_show();}};AbstractChosen.prototype.keyup_checker=function(evt){var stroke,_ref;stroke=(_ref=evt.which)!=null?_ref:evt.keyCode;this.search_field_scale();switch(stroke){case 8:if(this.is_multiple&&this.backstroke_length<1&&this.choices_count()>0){return this.keydown_backstroke();}else if(!this.pending_backstroke){this.result_clear_highlight();return this.results_search();}
break;case 13:evt.preventDefault();if(this.results_showing){return this.result_select(evt);}
break;case 27:if(this.results_showing){this.results_hide();}
return true;case 9:case 38:case 40:case 16:case 91:case 17:case 18:break;default:return this.results_search();}};AbstractChosen.prototype.clipboard_event_checker=function(evt){var _this=this;return setTimeout((function(){return _this.results_search();}),50);};AbstractChosen.prototype.container_width=function(){if(this.options.width!=null){return this.options.width;}else{return""+this.form_field.offsetWidth+"px";}};AbstractChosen.prototype.include_option_in_results=function(option){if(this.is_multiple&&(!this.display_selected_options&&option.selected)){return false;}
if(!this.display_disabled_options&&option.disabled){return false;}
if(option.empty){return false;}
return true;};AbstractChosen.prototype.search_results_touchstart=function(evt){this.touch_started=true;return this.search_results_mouseover(evt);};AbstractChosen.prototype.search_results_touchmove=function(evt){this.touch_started=false;return this.search_results_mouseout(evt);};AbstractChosen.prototype.search_results_touchend=function(evt){if(this.touch_started){return this.search_results_mouseup(evt);}};AbstractChosen.prototype.outerHTML=function(element){var tmp;if(element.outerHTML){return element.outerHTML;}
tmp=document.createElement("div");tmp.appendChild(element);return tmp.innerHTML;};AbstractChosen.browser_is_supported=function(){if(/iP(od|hone)/i.test(window.navigator.userAgent)){return false;}
if(/Android/i.test(window.navigator.userAgent)){if(/Mobile/i.test(window.navigator.userAgent)){return false;}}
if(/IEMobile/i.test(window.navigator.userAgent)){return false;}
if(/Windows Phone/i.test(window.navigator.userAgent)){return false;}
if(/BlackBerry/i.test(window.navigator.userAgent)){return false;}
if(/BB10/i.test(window.navigator.userAgent)){return false;}
if(window.navigator.appName==="Microsoft Internet Explorer"){return document.documentMode>=8;}
return true;};AbstractChosen.default_multiple_text="Select Some Options";AbstractChosen.default_single_text="Select an Option";AbstractChosen.default_no_result_text="No results match";return AbstractChosen;})();$=jQuery;$.fn.extend({chosen:function(options){if(!AbstractChosen.browser_is_supported()){return this;}
return this.each(function(input_field){var $this,chosen;$this=$(this);chosen=$this.data('chosen');if(options==='destroy'){if(chosen instanceof Chosen){chosen.destroy();}
return;}
if(!(chosen instanceof Chosen)){$this.data('chosen',new Chosen(this,options));}});}});Chosen=(function(_super){__extends(Chosen,_super);function Chosen(){_ref=Chosen.__super__.constructor.apply(this,arguments);return _ref;}
Chosen.prototype.setup=function(){this.form_field_jq=$(this.form_field);this.current_selectedIndex=this.form_field.selectedIndex;return this.is_rtl=this.form_field_jq.hasClass("chosen-rtl");};Chosen.prototype.set_up_html=function(){var container_classes,container_props;container_classes=["chosen-container"];container_classes.push("chosen-container-"+(this.is_multiple?"multi":"single"));if(this.inherit_select_classes&&this.form_field.className){container_classes.push(this.form_field.className);}
if(this.is_rtl){container_classes.push("chosen-rtl");}
container_props={'class':container_classes.join(' '),'title':this.form_field.title};if(this.form_field.id.length){container_props.id=this.form_field.id.replace(/[^\w]/g,'_')+"_chosen";}
this.container=$("<div />",container_props);if(this.is_multiple){this.container.html('<ul class="chosen-choices"><li class="search-field"><input type="text" value="'+this.default_text+'" class="default" autocomplete="off" style="width:25px;" /></li></ul><div class="chosen-drop"><ul class="chosen-results"></ul></div>');}else{this.container.html('<a class="chosen-single chosen-default"><span>'+this.default_text+'</span><div><b></b></div></a><div class="chosen-drop"><div class="chosen-search"><input type="text" autocomplete="off" /></div><ul class="chosen-results"></ul></div>');}
this.form_field_jq.hide().after(this.container);this.dropdown=this.container.find('div.chosen-drop').first();this.search_field=this.container.find('input').first();this.search_results=this.container.find('ul.chosen-results').first();this.search_field_scale();this.search_no_results=this.container.find('li.no-results').first();if(this.is_multiple){this.search_choices=this.container.find('ul.chosen-choices').first();this.search_container=this.container.find('li.search-field').first();}else{this.search_container=this.container.find('div.chosen-search').first();this.selected_item=this.container.find('.chosen-single').first();}
this.results_build();this.set_tab_index();return this.set_label_behavior();};Chosen.prototype.on_ready=function(){return this.form_field_jq.trigger("chosen:ready",{chosen:this});};Chosen.prototype.register_observers=function(){var _this=this;this.container.bind('touchstart.chosen',function(evt){_this.container_mousedown(evt);return evt.preventDefault();});this.container.bind('touchend.chosen',function(evt){_this.container_mouseup(evt);return evt.preventDefault();});this.container.bind('mousedown.chosen',function(evt){_this.container_mousedown(evt);});this.container.bind('mouseup.chosen',function(evt){_this.container_mouseup(evt);});this.container.bind('mouseenter.chosen',function(evt){_this.mouse_enter(evt);});this.container.bind('mouseleave.chosen',function(evt){_this.mouse_leave(evt);});this.search_results.bind('mouseup.chosen',function(evt){_this.search_results_mouseup(evt);});this.search_results.bind('mouseover.chosen',function(evt){_this.search_results_mouseover(evt);});this.search_results.bind('mouseout.chosen',function(evt){_this.search_results_mouseout(evt);});this.search_results.bind('mousewheel.chosen DOMMouseScroll.chosen',function(evt){_this.search_results_mousewheel(evt);});this.search_results.bind('touchstart.chosen',function(evt){_this.search_results_touchstart(evt);});this.search_results.bind('touchmove.chosen',function(evt){_this.search_results_touchmove(evt);});this.search_results.bind('touchend.chosen',function(evt){_this.search_results_touchend(evt);});this.form_field_jq.bind("chosen:updated.chosen",function(evt){_this.results_update_field(evt);});this.form_field_jq.bind("chosen:activate.chosen",function(evt){_this.activate_field(evt);});this.form_field_jq.bind("chosen:open.chosen",function(evt){_this.container_mousedown(evt);});this.form_field_jq.bind("chosen:close.chosen",function(evt){_this.input_blur(evt);});this.search_field.bind('blur.chosen',function(evt){_this.input_blur(evt);});this.search_field.bind('keyup.chosen',function(evt){_this.keyup_checker(evt);});this.search_field.bind('keydown.chosen',function(evt){_this.keydown_checker(evt);});this.search_field.bind('focus.chosen',function(evt){_this.input_focus(evt);});this.search_field.bind('cut.chosen',function(evt){_this.clipboard_event_checker(evt);});this.search_field.bind('paste.chosen',function(evt){_this.clipboard_event_checker(evt);});if(this.is_multiple){return this.search_choices.bind('click.chosen',function(evt){_this.choices_click(evt);});}else{return this.container.bind('click.chosen',function(evt){evt.preventDefault();});}};Chosen.prototype.destroy=function(){$(this.container[0].ownerDocument).unbind("click.chosen",this.click_test_action);if(this.search_field[0].tabIndex){this.form_field_jq[0].tabIndex=this.search_field[0].tabIndex;}
this.container.remove();this.form_field_jq.removeData('chosen');return this.form_field_jq.show();};Chosen.prototype.search_field_disabled=function(){this.is_disabled=this.form_field_jq[0].disabled;if(this.is_disabled){this.container.addClass('chosen-disabled');this.search_field[0].disabled=true;if(!this.is_multiple){this.selected_item.unbind("focus.chosen",this.activate_action);}
return this.close_field();}else{this.container.removeClass('chosen-disabled');this.search_field[0].disabled=false;if(!this.is_multiple){return this.selected_item.bind("focus.chosen",this.activate_action);}}};Chosen.prototype.container_mousedown=function(evt){if(!this.is_disabled){if(evt&&evt.type==="mousedown"&&!this.results_showing){evt.preventDefault();}
if(!((evt!=null)&&($(evt.target)).hasClass("search-choice-close"))){if(!this.active_field){if(this.is_multiple){this.search_field.val("");}
$(this.container[0].ownerDocument).bind('click.chosen',this.click_test_action);this.results_show();}else if(!this.is_multiple&&evt&&(($(evt.target)[0]===this.selected_item[0])||$(evt.target).parents("a.chosen-single").length)){evt.preventDefault();this.results_toggle();}
return this.activate_field();}}};Chosen.prototype.container_mouseup=function(evt){if(evt.target.nodeName==="ABBR"&&!this.is_disabled){return this.results_reset(evt);}};Chosen.prototype.search_results_mousewheel=function(evt){var delta;if(evt.originalEvent){delta=evt.originalEvent.deltaY||-evt.originalEvent.wheelDelta||evt.originalEvent.detail;}
if(delta!=null){evt.preventDefault();if(evt.type==='DOMMouseScroll'){delta=delta*40;}
return this.search_results.scrollTop(delta+this.search_results.scrollTop());}};Chosen.prototype.blur_test=function(evt){if(!this.active_field&&this.container.hasClass("chosen-container-active")){return this.close_field();}};Chosen.prototype.close_field=function(){$(this.container[0].ownerDocument).unbind("click.chosen",this.click_test_action);this.active_field=false;this.results_hide();this.container.removeClass("chosen-container-active");this.clear_backstroke();this.show_search_field_default();return this.search_field_scale();};Chosen.prototype.activate_field=function(){this.container.addClass("chosen-container-active");this.active_field=true;this.search_field.val(this.search_field.val());return this.search_field.focus();};Chosen.prototype.test_active_click=function(evt){var active_container;active_container=$(evt.target).closest('.chosen-container');if(active_container.length&&this.container[0]===active_container[0]){return this.active_field=true;}else{return this.close_field();}};Chosen.prototype.results_build=function(){this.parsing=true;this.selected_option_count=null;this.results_data=SelectParser.select_to_array(this.form_field);if(this.is_multiple){this.search_choices.find("li.search-choice").remove();}else if(!this.is_multiple){this.single_set_selected_text();if(this.disable_search||this.form_field.options.length<=this.disable_search_threshold){this.search_field[0].readOnly=true;this.container.addClass("chosen-container-single-nosearch");}else{this.search_field[0].readOnly=false;this.container.removeClass("chosen-container-single-nosearch");}}
this.update_results_content(this.results_option_build({first:true}));this.search_field_disabled();this.show_search_field_default();this.search_field_scale();return this.parsing=false;};Chosen.prototype.result_do_highlight=function(el){var high_bottom,high_top,maxHeight,visible_bottom,visible_top;if(el.length){this.result_clear_highlight();this.result_highlight=el;this.result_highlight.addClass("highlighted");maxHeight=parseInt(this.search_results.css("maxHeight"),10);visible_top=this.search_results.scrollTop();visible_bottom=maxHeight+visible_top;high_top=this.result_highlight.position().top+this.search_results.scrollTop();high_bottom=high_top+this.result_highlight.outerHeight();if(high_bottom>=visible_bottom){return this.search_results.scrollTop((high_bottom-maxHeight)>0?high_bottom-maxHeight:0);}else if(high_top<visible_top){return this.search_results.scrollTop(high_top);}}};Chosen.prototype.result_clear_highlight=function(){if(this.result_highlight){this.result_highlight.removeClass("highlighted");}
return this.result_highlight=null;};Chosen.prototype.results_show=function(){if(this.is_multiple&&this.max_selected_options<=this.choices_count()){this.form_field_jq.trigger("chosen:maxselected",{chosen:this});return false;}
this.container.addClass("chosen-with-drop");this.results_showing=true;this.search_field.focus();this.search_field.val(this.search_field.val());this.winnow_results();return this.form_field_jq.trigger("chosen:showing_dropdown",{chosen:this});};Chosen.prototype.update_results_content=function(content){return this.search_results.html(content);};Chosen.prototype.results_hide=function(){if(this.results_showing){this.result_clear_highlight();this.container.removeClass("chosen-with-drop");this.form_field_jq.trigger("chosen:hiding_dropdown",{chosen:this});}
return this.results_showing=false;};Chosen.prototype.set_tab_index=function(el){var ti;if(this.form_field.tabIndex){ti=this.form_field.tabIndex;this.form_field.tabIndex=-1;return this.search_field[0].tabIndex=ti;}};Chosen.prototype.set_label_behavior=function(){var _this=this;this.form_field_label=this.form_field_jq.parents("label");if(!this.form_field_label.length&&this.form_field.id.length){this.form_field_label=$("label[for='"+this.form_field.id+"']");}
if(this.form_field_label.length>0){return this.form_field_label.bind('click.chosen',function(evt){if(_this.is_multiple){return _this.container_mousedown(evt);}else{return _this.activate_field();}});}};Chosen.prototype.show_search_field_default=function(){if(this.is_multiple&&this.choices_count()<1&&!this.active_field){this.search_field.val(this.default_text);return this.search_field.addClass("default");}else{this.search_field.val("");return this.search_field.removeClass("default");}};Chosen.prototype.search_results_mouseup=function(evt){var target;target=$(evt.target).hasClass("active-result")?$(evt.target):$(evt.target).parents(".active-result").first();if(target.length){this.result_highlight=target;this.result_select(evt);return this.search_field.focus();}};Chosen.prototype.search_results_mouseover=function(evt){var target;target=$(evt.target).hasClass("active-result")?$(evt.target):$(evt.target).parents(".active-result").first();if(target){return this.result_do_highlight(target);}};Chosen.prototype.search_results_mouseout=function(evt){if($(evt.target).hasClass("active-result"||$(evt.target).parents('.active-result').first())){return this.result_clear_highlight();}};Chosen.prototype.choice_build=function(item){var choice,close_link,_this=this;choice=$('<li />',{"class":"search-choice"}).html("<span>"+(this.choice_label(item))+"</span>");if(item.disabled){choice.addClass('search-choice-disabled');}else{close_link=$('<a />',{"class":'search-choice-close','data-option-array-index':item.array_index});close_link.bind('click.chosen',function(evt){return _this.choice_destroy_link_click(evt);});choice.append(close_link);}
return this.search_container.before(choice);};Chosen.prototype.choice_destroy_link_click=function(evt){evt.preventDefault();evt.stopPropagation();if(!this.is_disabled){return this.choice_destroy($(evt.target));}};Chosen.prototype.choice_destroy=function(link){if(this.result_deselect(link[0].getAttribute("data-option-array-index"))){this.show_search_field_default();if(this.is_multiple&&this.choices_count()>0&&this.search_field.val().length<1){this.results_hide();}
link.parents('li').first().remove();return this.search_field_scale();}};Chosen.prototype.results_reset=function(){this.reset_single_select_options();this.form_field.options[0].selected=true;this.single_set_selected_text();this.show_search_field_default();this.results_reset_cleanup();this.form_field_jq.trigger("change");if(this.active_field){return this.results_hide();}};Chosen.prototype.results_reset_cleanup=function(){this.current_selectedIndex=this.form_field.selectedIndex;return this.selected_item.find("abbr").remove();};Chosen.prototype.result_select=function(evt){var high,item;if(this.result_highlight){high=this.result_highlight;this.result_clear_highlight();if(this.is_multiple&&this.max_selected_options<=this.choices_count()){this.form_field_jq.trigger("chosen:maxselected",{chosen:this});return false;}
if(this.is_multiple){high.removeClass("active-result");}else{this.reset_single_select_options();}
high.addClass("result-selected");item=this.results_data[high[0].getAttribute("data-option-array-index")];item.selected=true;this.form_field.options[item.options_index].selected=true;this.selected_option_count=null;if(this.is_multiple){this.choice_build(item);}else{this.single_set_selected_text(this.choice_label(item));}
if(!((evt.metaKey||evt.ctrlKey)&&this.is_multiple)){this.results_hide();}
this.show_search_field_default();if(this.is_multiple||this.form_field.selectedIndex!==this.current_selectedIndex){this.form_field_jq.trigger("change",{'selected':this.form_field.options[item.options_index].value});}
this.current_selectedIndex=this.form_field.selectedIndex;evt.preventDefault();return this.search_field_scale();}};Chosen.prototype.single_set_selected_text=function(text){if(text==null){text=this.default_text;}
if(text===this.default_text){this.selected_item.addClass("chosen-default");}else{this.single_deselect_control_build();this.selected_item.removeClass("chosen-default");}
return this.selected_item.find("span").html(text);};Chosen.prototype.result_deselect=function(pos){var result_data;result_data=this.results_data[pos];if(!this.form_field.options[result_data.options_index].disabled){result_data.selected=false;this.form_field.options[result_data.options_index].selected=false;this.selected_option_count=null;this.result_clear_highlight();if(this.results_showing){this.winnow_results();}
this.form_field_jq.trigger("change",{deselected:this.form_field.options[result_data.options_index].value});this.search_field_scale();return true;}else{return false;}};Chosen.prototype.single_deselect_control_build=function(){if(!this.allow_single_deselect){return;}
if(!this.selected_item.find("abbr").length){this.selected_item.find("span").first().after("<abbr class=\"search-choice-close\"></abbr>");}
return this.selected_item.addClass("chosen-single-with-deselect");};Chosen.prototype.get_search_text=function(){return $('<div/>').text($.trim(this.search_field.val())).html();};Chosen.prototype.winnow_results_set_highlight=function(){var do_high,selected_results;selected_results=!this.is_multiple?this.search_results.find(".result-selected.active-result"):[];do_high=selected_results.length?selected_results.first():this.search_results.find(".active-result").first();if(do_high!=null){return this.result_do_highlight(do_high);}};Chosen.prototype.no_results=function(terms){var no_results_html;no_results_html=$('<li class="no-results">'+this.results_none_found+' "<span></span>"</li>');no_results_html.find("span").first().html(terms);this.search_results.append(no_results_html);return this.form_field_jq.trigger("chosen:no_results",{chosen:this});};Chosen.prototype.no_results_clear=function(){return this.search_results.find(".no-results").remove();};Chosen.prototype.keydown_arrow=function(){var next_sib;if(this.results_showing&&this.result_highlight){next_sib=this.result_highlight.nextAll("li.active-result").first();if(next_sib){return this.result_do_highlight(next_sib);}}else{return this.results_show();}};Chosen.prototype.keyup_arrow=function(){var prev_sibs;if(!this.results_showing&&!this.is_multiple){return this.results_show();}else if(this.result_highlight){prev_sibs=this.result_highlight.prevAll("li.active-result");if(prev_sibs.length){return this.result_do_highlight(prev_sibs.first());}else{if(this.choices_count()>0){this.results_hide();}
return this.result_clear_highlight();}}};Chosen.prototype.keydown_backstroke=function(){var next_available_destroy;if(this.pending_backstroke){this.choice_destroy(this.pending_backstroke.find("a").first());return this.clear_backstroke();}else{next_available_destroy=this.search_container.siblings("li.search-choice").last();if(next_available_destroy.length&&!next_available_destroy.hasClass("search-choice-disabled")){this.pending_backstroke=next_available_destroy;if(this.single_backstroke_delete){return this.keydown_backstroke();}else{return this.pending_backstroke.addClass("search-choice-focus");}}}};Chosen.prototype.clear_backstroke=function(){if(this.pending_backstroke){this.pending_backstroke.removeClass("search-choice-focus");}
return this.pending_backstroke=null;};Chosen.prototype.keydown_checker=function(evt){var stroke,_ref1;stroke=(_ref1=evt.which)!=null?_ref1:evt.keyCode;this.search_field_scale();if(stroke!==8&&this.pending_backstroke){this.clear_backstroke();}
switch(stroke){case 8:this.backstroke_length=this.search_field.val().length;break;case 9:if(this.results_showing&&!this.is_multiple){this.result_select(evt);}
this.mouse_on_container=false;break;case 13:if(this.results_showing){evt.preventDefault();}
break;case 32:if(this.disable_search){evt.preventDefault();}
break;case 38:evt.preventDefault();this.keyup_arrow();break;case 40:evt.preventDefault();this.keydown_arrow();break;}};Chosen.prototype.search_field_scale=function(){var div,f_width,h,style,style_block,styles,w,_i,_len;if(this.is_multiple){h=0;w=0;style_block="position:absolute; left: -1000px; top: -1000px; display:none;";styles=['font-size','font-style','font-weight','font-family','line-height','text-transform','letter-spacing'];for(_i=0,_len=styles.length;_i<_len;_i++){style=styles[_i];style_block+=style+":"+this.search_field.css(style)+";";}
div=$('<div />',{'style':style_block});div.text(this.search_field.val());$('body').append(div);w=div.width()+25;div.remove();f_width=this.container.outerWidth();if(w>f_width-10){w=f_width-10;}
return this.search_field.css({'width':w+'px'});}};return Chosen;})(AbstractChosen);}).call(this);;(function(){var model={indexes:{WORLD:"world",US:"us"},actions:{GET_INITIAL_DATA:"getInitialData",GET_FOUNDATIONS:"getFoundations",GET_LOCATION_SCORES:"getLocationScores"},getInitialData:function(){var deferred=$.Deferred();$.post(BASE_URL+"/controllers/in-depth-results-api.php",{action:this.actions.GET_INITIAL_DATA},function(data){deferred.resolve(JSON.parse(data));});return deferred.promise();},getLocationScores:function(index,abbr){var deferred=$.Deferred();$.post(BASE_URL+"/controllers/in-depth-results-api.php",{action:this.actions.GET_LOCATION_SCORES,index:index,abbr:abbr},function(data){deferred.resolve(JSON.parse(data));});return deferred.promise();},};var controller={init:function(){var self=this;self.currentIndex=self.getIndexes().US;overlayView.init().show();model.getInitialData().done(function(initialData){self.locations=initialData.locations;self.dataStructure=initialData.data_structure;foundationsView.init();indexSelectionView.init().render();locationSelectionView.init((self.currentIndex===self.getIndexes().WORLD)?self.locations.world:self.locations.us).render();});},getIndexes:function(){return model.indexes;},getLocationScores:function(index,abbr){return model.getLocationScores(index,abbr)}};var indexSelectionView={init:function(){this.selectWorld=$("#btn_select_world");this.selectUs=$("#btn_select_us");this.selectWorld.unbind("click");this.selectUs.unbind("click");return this;},render:function(){this.selectWorld.click(function(){if(controller.currentIndex!=controller.getIndexes().WORLD){controller.currentIndex=controller.getIndexes().WORLD;locationSelectionView.init((controller.currentIndex===controller.getIndexes().WORLD)?controller.locations.world:controller.locations.us).render();}});this.selectUs.click(function(){if(controller.currentIndex!=controller.getIndexes().US){controller.currentIndex=controller.getIndexes().US;locationSelectionView.init((controller.currentIndex===controller.getIndexes().WORLD)?controller.locations.world:controller.locations.us).render();}});return this;}};var locationSelectionView={init:function(locations){this.locations=locations;this.view=$("#location_selection").chosen({});this.view.unbind("change");return this;},render:function(){var locationsLength=this.locations.length;this.view.empty();for(var i=0;i<locationsLength;i++){this.view.append("<option value="+this.locations[i].abbr+">"+this.locations[i].name+"</option>");}
this.view.on("change",this.onChange);this.view.trigger("change");this.view.chosen({}).trigger("chosen:updated");return this;},onChange:function(event,params){if(!overlayView.isBlocking()){overlayView.show();}
var locationAbbr=(params===undefined)?event.target[0].value:params.selected;controller.getLocationScores(controller.currentIndex,locationAbbr).done(function(data){controller.locationScores=data;locationMapSVGView.init().render();foundationsView.init().render();overlayView.hide();});}};var foundationsView={init:function(){this.data=(controller.locationScores===undefined)?{}:controller.locationScores.overall_foundation_scores;this.dataStructure=(controller.currentIndex===controller.getIndexes().WORLD)?controller.dataStructure.world:controller.dataStructure.us;this.colors={community_and_relationships:"#B11E2B",freedom_and_opportunity:"#3D4780",health_and_environment:"#CC4E00",living_standard:"#006538",peace_and_security:"#501050"};for(var foundation in this.dataStructure.dimensions){var id=foundation+"_chart";this[id]=$("#"+id).asPieProgress({namespace:"asPieProgress",min:0,max:100,step:1,speed:30,delay:0,barsize:"17",barcolor:this.colors[foundation],easing:"ease",numberCallback:function(n){return(this.now/10);}}).unbind("click");}
this.overallChart=$("#overall_chart").empty().drawDoughnutChart([]);return this;},render:function(){var overallData=[];for(var foundation in this.dataStructure.dimensions){var id=foundation+"_chart",foundationScore=parseFloat(this.data[foundation]).toFixed(1),numOfFoundations=Object.keys(this.dataStructure.dimensions).length;this[id].asPieProgress("go",foundationScore*10).on("click",this.onFoundationClick);if(this[id].hasClass("active")){this[id].click();}
overallData.push({title:foundation.display_name,value:foundationScore/numOfFoundations,color:this.colors[foundation]});}
this.overallChart.empty().drawDoughnutChart(overallData);return this;},onFoundationClick:function(){for(var foundation in foundationsView.dataStructure.dimensions){var id=foundation+"_chart";if($(this).attr("id")!=(foundation+"_chart")){$("#"+id).removeClass("active");}
else{$(this).addClass("active");componentSelectionView.init(foundation).render();}}}};var componentSelectionView={init:function(foundation){this.foundation=foundation;this.dataStructure=(controller.currentIndex===controller.getIndexes().WORLD)?controller.dataStructure.world:controller.dataStructure.us;this.view=$("#component_selection").chosen({});this.view.unbind("change");this.components=[];for(var component in this.dataStructure.dimensions[foundation].components){this.components.push({value:component,displayName:this.dataStructure.dimensions[foundation].components[component].display_name});}
return this;},render:function(){var componentsLength=this.components.length;this.view.empty();for(var i=0;i<componentsLength;i++){this.view.append("<option value="+this.components[i].value+">"+this.components[i].displayName+"</option>");}
this.view.on("change",this.onChange.bind(this));this.view.trigger("change");this.view.chosen({}).trigger("chosen:updated");return this;},onChange:function(event,params){var component=(params===undefined)?event.target[0].value:params.selected;componentsView.init(this.foundation,component).render();subcomponentsView.init(this.foundation,component).render();}}
var componentsView={init:function(foundation,component){this.foundation=foundation;this.component=component;this.dataStructure=(controller.currentIndex===controller.getIndexes().WORLD)?controller.dataStructure.world:controller.dataStructure.us;this.colors={community_and_relationships:"#B11E2B",freedom_and_opportunity:"#3D4780",health_and_environment:"#CC4E00",living_standard:"#006538",peace_and_security:"#501050"};this.view=$("#components_chart");var dataSourceLength=controller.locationScores.components.length;this.dataSource=[];for(var i=0;i<dataSourceLength;i++){this.dataSource.push({year:controller.locationScores.components[i].year,value:Number(parseFloat(controller.locationScores.components[i][component]).toFixed(2)),});}
return this;},render:function(){this.view.dxChart({dataSource:this.dataSource,series:{argumentField:"year",valueField:"value",type:"bar",color:this.colors[this.foundation]},legend:{visible:false},valueAxis:{valueMarginsEnabled:false,min:0,max:10},scrollBar:{visible:false},scrollingMode:"all",zoomingMode:"all"});return this;}};var subcomponentsView={init:function(foundation,component){this.foundation=foundation;this.component=component;this.dataStructure=(controller.currentIndex===controller.getIndexes().WORLD)?controller.dataStructure.world:controller.dataStructure.us;this.view=$("#subcomponents_chart");this.subcomponents=this.dataStructure.dimensions[this.foundation].components[this.component].subcomponents;var subcomponentsLength=Object.keys(this.subcomponents).length;var dataSourceLength=controller.locationScores.subcomponents.length;this.dataSource=[];this.series=[];for(var i=0;i<dataSourceLength;i++){var data={};for(var key in this.subcomponents){data["year"]=controller.locationScores.subcomponents[i].year;data[key]=Number(parseFloat(controller.locationScores.subcomponents[i][key]).toFixed(2));}
this.dataSource.push(data);}
for(var key in this.subcomponents){this.series.push({valueField:key,name:this.subcomponents[key].display_name});}
return this;},render:function(){var chartOptions={dataSource:this.dataSource,series:this.series,commonSeriesSettings:{argumentField:"year",type:"line"},margin:{bottom:20},argumentAxis:{valueMarginsEnabled:false,discreteAxisDivisionMode:"crossLabels",grid:{visible:true}},valueAxis:{min:0,max:10,tickInterval:1},legend:{verticalAlignment:"bottom",horizontalAlignment:"center",itemTextPosition:"bottom"},title:{text:this.dataStructure.dimensions[this.foundation].components[this.component].display_name,subtitle:{text:(this.series.length>=1)?"(Subcomponents)":"(No Subcomponents)"}},tooltip:{enabled:true,customizeTooltip:function(arg){return{text:arg.valueText};}},scrollBar:{visible:false},scrollingMode:"all",zoomingMode:"all"};this.view.dxChart(chartOptions);return this;}};var locationMapSVGView={init:function(abbr){var index=(controller.currentIndex===controller.getIndexes().WORLD)?"int":"us";this.path=BASE_URL+"/wp-content/themes/life-measures/images/svg_in_depth_map/"+index+"/"+controller.locationScores.abbr+".svg";this.view=$("#location_map_svg");return this;},render:function(){this.view.load(this.path);return this;}};var overlayView={init:function(){this.view=$("body");this.viewOptions={message:"<h1><img src='"+TEMPLATE_DIRECTORY_URL+"/images/pre-loader.gif' /></h1>",overlayCSS:{backgroundColor:"#fff"}};return this;},show:function(){this.view.block(this.viewOptions);},hide:function(){this.view.unblock();},isBlocking:function(){if($(".blockUI").length){return true;}
else{return false;}}};controller.init();})();